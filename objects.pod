
=head1 The Object System

=head2 Thoughts

I'm not going to try to implement the object system in pure Deck.
You're welcome.

For now, builtin types (list, string, etc.) are not OOPS.  That will
change.

Objects are a special type.

Classes are also a special type.  They are also callable and create
instances, then call 'INIT' with their arguments.

Let's use 'new' to create instances.  There's no real advantage to
making classes callable.

I'm not going to use the Perl object system until I have a better
grasp of everything.

=head2 Syntax

	class Foo Object {
		var xxx = 42
		var yyy = 53

		method INIT {x} {puts x}

		method bar {a} {puts a}
		method quux {b} {puts b}
	}


	[o->m 42]

	-"->" is magical.
		-in prefix expressions, o->m is equivalent to (o->m) 
		 at the start of an expression
		-if escaped, behaves as usual.

	-"." is magical
			o.xxx = 123
			o.yyy = o.xxx + 42
			z = [foo o.xxx o.yyy]
		-'.' magically autoparens
X		-'.' needs higher precedence than '->'.
X			o.so->foo




=head2 Semantics

	-instance variables are visible only to the object's methods, NOT to
	 subclasses and NOT to methods added after the fact.

	-where is 'self' added?

		stdout->print 42

		[\-> stdout print] 42

		var n = stdout->print
		n 42

	-what if a local class existed in the context that defined it?

	-'public', 'readable' and 'writeable' declare public access for
	 ivars.

	-'super' is a magic word used by the . and -> macros as a flag
	 to indicate that it should expand to a different lookup function.

	-'_' convention should work on accessors as well.  So need to
	 append _get or _set rather than prepending.

	-going to make all ivars C++-private.


=head3 Subclass Implementation

	-objects are still a hash of names/values
		-ivars are mangled with the class ID.
		-uses are mangled at compile time.
			-this has to be done in methods and subs inside methods.

	-for now, we can get most of this by requiring that ivars are
	 unique in an inheritance tree.
		-call it a ToDo.
	



=head2 To Do

	-basic class and object
X		-'class' type.
			-perlform
X			-at, atPut, size, isIndexible
X		-'object' type.
X			-doesNotUnderstand
X		-lookup function.
X			-special syntax for lookup.
X		-class definition
X			-class macro
X			-_::class function
X				-inheritance
X				-methods
X					-private methods
X						-enforce at macro level
X						-rename get and set so that _ is preserved
X					-must return self
X					-self must be const
X					-super
X				-instance variables
X				-attributes
X					-access methods
X					-'.'
X						-assignment support
X						-autoparen
X						-_set must return assignment value
X			-initializer
X				-field initialization  (left out for now--spooky)
X		-class 'Object'
X			-isTrue

		-binary operator to method conversion
			-equals

X		-object instantiation
	
X		-make LL::Object a subclass of Context.
	
=head 2 To Test

X	-do init args match up with [new Class args]?
X	-test passing args to _init
X	-subclass ivar may not mask superclass ivar
X	-private methods


=head2 Promoting Builtin Types

	1) Add class Datum as the root.
	2) Add Deck classes for the builtins.
	3) Add method 'deckClass' to all Deck types to retrieve
	   the class.  For Objects, it returns the ' class' field; for
	   everything else, it's the builtin Deck class.
	4) replace all uses of ' class' with calls to 'deckClass'.



=head2 Issues

	-does a field decl. like "var x = [foo 4 2]" work?
		-what field order should I use?
		-how do I initialize them.
			-maybe define a bunch of unnamed methods to do it?
		-answer: no.  Too spooky.  Do it in _init.











